preprocess_miRNA(geo_id)
} else {
preprocess_microarray(geo_id)
}
}
# ==============================================
# Script 02: Exploratory Analysis & Differential Expression
# Description: Uses processed RDS files (from Script 01)
#              Performs PCA, QC plots, and DE analysis
# Author: Roozbeh Heidarzadehpilehrood
# Date: 2026-01-15
# ==============================================
# --- 0. Setup ---
library(tidyverse)
library(DESeq2)
library(pheatmap)
library(RColorBrewer)
# Create folders if they don't exist
if(!dir.exists("results/plots")) dir.create("results/plots", recursive = TRUE)
if(!dir.exists("results/DEGs")) dir.create("results/DEGs", recursive = TRUE)
# --- 1. Load processed datasets ---
message("Loading processed datasets from RDS...")
gse14407 <- readRDS("data/RDS/GSE14407_processed.RDS")
> list.files("data/GEO_raw/")
# ==============================================
# Script 02: Exploratory Analysis & Differential Expression
# Description: Uses processed RDS files (from Script 01)
#              Performs PCA, QC plots, and DE analysis
# Author: Roozbeh Heidarzadehpilehrood
# Date: 2026-02-15
# ==============================================
# --- 0. Setup ---
library(tidyverse)
library(DESeq2)
library(pheatmap)
library(RColorBrewer)
# Create folders if they don't exist
if(!dir.exists("results/plots")) dir.create("results/plots", recursive = TRUE)
if(!dir.exists("results/DEGs")) dir.create("results/DEGs", recursive = TRUE)
# --- 1. Load processed datasets ---
message("Loading processed datasets from RDS...")
gse14407 <- readRDS("data/RDS/GSE14407_processed.RDS")
list.files("data/RDS/")
# Script 02: Load Processed RDS Files and Prepare for Analysis
# Author: Roozbeh
# Description: Automatically loads all processed GEO microarray RDS files from data/GEO_rds/
#              and combines them into a list for downstream analyses.
# Required libraries
library(dplyr)
library(tibble)
library(stringr)
# ---- Config ----
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_loaded_data/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# ---- Step 1: List all RDS files ----
rds_files <- list.files(rds_folder, pattern = "_processed\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No processed RDS files found in the folder!")
# Script 02: Load Processed RDS Files and Prepare for Analysis
# Author: Roozbeh
# Description: Automatically loads all processed GEO microarray RDS files from data/GEO_rds/
#              and combines them into a list for downstream analyses.
# Required libraries
library(dplyr)
library(tibble)
library(stringr)
# ---- Config ----
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_loaded_data/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# ---- Step 1: List all RDS files ----
rds_files <- list.files(rds_folder, pattern = "_processed\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No processed RDS files found in the folder!")
# ===============================================
# Script 01: Preprocess GEO Microarray Datasets
# Author: Roozbeh
# Purpose: Read CSVs from GEO, basic preprocessing, and save RDS files
# Datasets: GSE14407, GSE216150, GSE38666, GSE52037
# ===============================================
# --- 0. Setup environment ---
rm(list = ls())
options(stringsAsFactors = FALSE)
library(dplyr)
# --- 1. Define paths and GEO IDs ---
geo_ids <- c("GSE14407", "GSE216150", "GSE38666", "GSE52037")
raw_data_path <- "data/GEO_raw/"
rds_output_path <- "data/GEO_rds/"
if(!dir.exists(rds_output_path)) dir.create(rds_output_path)
# --- 2. Function: basic preprocessing ---
preprocess_dataset <- function(expr_csv, pheno_csv){
expr <- read.csv(expr_csv, row.names = 1)
pheno <- read.csv(pheno_csv, row.names = 1)
# Log2 transform
expr <- log2(expr + 1)
# Remove empty rows
expr <- expr[!apply(expr, 1, function(x) all(is.na(x))), ]
return(list(expr = expr, pheno = pheno))
}
# --- 3. Loop over GEO IDs and process ---
for(gid in geo_ids){
cat("ðŸ”¹ Processing ", gid, "...\n")
expr_csv <- paste0(raw_data_path, gid, "_expression_matrix.csv")
pheno_csv <- paste0(raw_data_path, gid, "_phenotype_data.csv")
if(!file.exists(expr_csv) | !file.exists(pheno_csv)){
warning("âš ï¸ Files for ", gid, " not found. Skipping...")
next
}
processed <- preprocess_dataset(expr_csv, pheno_csv)
# --- 4. Save RDS files for Script 02 ---
saveRDS(processed$expr, paste0(rds_output_path, gid, "_expr_raw.RDS"))
saveRDS(processed$pheno, paste0(rds_output_path, gid, "_pheno_raw.RDS"))
cat("âœ… ", gid, " processed and saved as RDS.\n\n")
}
# --- 5. Summary ---
cat("All datasets processed. RDS files saved in: ", rds_output_path, "\n")
# Script 02: Load Processed RDS Files and Prepare for Analysis
# Author: Roozbeh
# Description: Automatically loads all processed GEO microarray RDS files from data/GEO_rds/
#              and combines them into a list for downstream analyses.
# Required libraries
library(dplyr)
library(tibble)
library(stringr)
# ---- Config ----
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_loaded_data/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# ---- Step 1: List all RDS files ----
rds_files <- list.files(rds_folder, pattern = "_processed\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No processed RDS files found in the folder!")
# Script 02: Load Processed RDS Files and Prepare for Analysis
# Author: Roozbeh
# Description: Automatically loads all processed GEO microarray RDS files from data/GEO_rds/
#              and combines them into a list for downstream analyses.
# Required libraries
library(dplyr)
library(tibble)
library(stringr)
# ---- Config ----
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_loaded_data/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# Step 1: List all RDS files (accept any .RDS)
rds_files <- list.files(rds_folder, pattern = "\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No RDS files found in the folder!")
# ---- Step 2: Load all RDS files into a named list ----
geo_data <- list()
for(f in rds_files) {
gse_id <- str_extract(basename(f), "GSE\\d+")
message("Loading ", gse_id, " ...")
geo_data[[gse_id]] <- readRDS(f)
}
# ---- Step 3: Quick summary of loaded datasets ----
for(gse_id in names(geo_data)) {
cat("Dataset:", gse_id, "\n")
cat("  Samples:", ncol(geo_data[[gse_id]]$exprs), "\n")
cat("  Features:", nrow(geo_data[[gse_id]]$exprs), "\n\n")
}
# ---- Step 4: Save combined list for downstream scripts ----
saveRDS(geo_data, file = file.path(output_folder, "all_GEO_processed_list.RDS"))
message("All datasets combined and saved to ", output_folder)
# Script 03: PCA and Volcano Plots for GEO Microarray Datasets
# Author: Roozbeh
# Description: Performs PCA on normalized expression matrices and generates volcano plots for DEGs
#              for all processed GEO microarray datasets. Outputs saved in results/03_analysis/.
# Required libraries
library(limma)
library(ggplot2)
library(dplyr)
library(tibble)
library(stringr)
# ---- Config ----
rds_file <- "results/02_loaded_data/all_GEO_processed_list.RDS"
output_folder <- "results/03_analysis/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# ---- Step 1: Load combined RDS ----
geo_data <- readRDS(rds_file)
# ---- Step 2: Loop through each dataset ----
for(dataset_name in names(geo_data)) {
cat("Processing dataset:", dataset_name, "\n")
expr <- geo_data[[dataset_name]]$expression
pheno <- geo_data[[dataset_name]]$phenotype
# ---- PCA ----
pca_res <- prcomp(t(expr), scale. = TRUE)
percent_var <- round(100 * (pca_res$sdev^2 / sum(pca_res$sdev^2)), 1)
pca_df <- as.data.frame(pca_res$x) %>%
rownames_to_column(var = "Sample") %>%
left_join(pheno, by = c("Sample" = "SampleID"))  # Adjust column name for sample IDs
p <- ggplot(pca_df, aes(x = PC1, y = PC2, color = Group)) +
geom_point(size = 3) +
theme_bw() +
labs(title = paste0("PCA - ", dataset_name),
x = paste0("PC1 (", percent_var[1], "%)"),
y = paste0("PC2 (", percent_var[2], "%)")) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(filename = file.path(output_folder, paste0(dataset_name, "_PCA.png")),
plot = p, width = 6, height = 5)
# ---- Differential Expression (limma) ----
# Make sure Group is factor with two levels
group_factor <- factor(pheno$Group)
design <- model.matrix(~0 + group_factor)
colnames(design) <- levels(group_factor)
fit <- lmFit(expr, design)
contrast_matrix <- makeContrasts(Contrast = levels(group_factor)[2] - levels(group_factor)[1], levels = design)
fit2 <- contrasts.fit(fit, contrast_matrix)
fit2 <- eBayes(fit2)
degs <- topTable(fit2, number = Inf, adjust.method = "fdr")
# Save DEG table
write.csv(degs, file = file.path(output_folder, paste0(dataset_name, "_DEGs.csv")), row.names = TRUE)
# ---- Volcano Plot ----
degs$Significant <- ifelse(degs$adj.P.Val < 0.05 & abs(degs$logFC) > 1, "Yes", "No")
vplot <- ggplot(degs, aes(x = logFC, y = -log10(adj.P.Val), color = Significant)) +
geom_point(alpha = 0.6) +
scale_color_manual(values = c("No" = "grey", "Yes" = "red")) +
theme_bw() +
labs(title = paste0("Volcano Plot - ", dataset_name),
x = "log2 Fold Change",
y = "-log10 Adjusted P-value") +
theme(plot.title = element_text(hjust = 0.5))
ggsave(filename = file.path(output_folder, paste0(dataset_name, "_Volcano.png")),
plot = vplot, width = 6, height = 5)
cat("Finished dataset:", dataset_name, "\n\n")
}
# Script 02: Load Processed RDS Files and Prepare for Analysis
# Author: Roozbeh
# Description: Automatically loads all processed GEO microarray RDS files from data/GEO_rds/
#              and combines them into a list for downstream analyses.
# Required libraries
library(dplyr)
library(tibble)
library(stringr)
# ---- Config ----
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_loaded_data/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# Step 1: List all RDS files (accept any .RDS)
rds_files <- list.files(rds_folder, pattern = "\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No RDS files found in the folder!")
# ---- Step 2: Load all RDS files into a named list ----
geo_data <- list()
for(f in rds_files) {
gse_id <- str_extract(basename(f), "GSE\\d+")
message("Loading ", gse_id, " ...")
geo_data[[gse_id]] <- readRDS(f)
}
# ---- Step 3: Quick summary of loaded datasets ----
for(gse_id in names(geo_data)) {
cat("Dataset:", gse_id, "\n")
cat("  Samples:", ncol(geo_data[[gse_id]]$exprs), "\n")
cat("  Features:", nrow(geo_data[[gse_id]]$exprs), "\n\n")
}
# ---- Step 4: Save combined list for downstream scripts ----
saveRDS(geo_data, file = file.path(output_folder, "all_GEO_processed_list.RDS"))
message("All datasets combined and saved to ", output_folder)
# Script 03: Differential Expression and Volcano Plots
# Author: Roozbeh
# Description: Loads processed GEO RDS files, runs DE analysis and generates volcano plots
library(dplyr)
library(tibble)
library(ggplot2)
library(limma)
library(stringr)
# ---- Config ----
rds_folder <- "data/GEO_rds/"
output_folder <- "results/03_DE_analysis/"
dir.create(output_folder, recursive = TRUE, showWarnings = FALSE)
# ---- Step 1: Load all RDS files ----
rds_files <- list.files(rds_folder, pattern = "_processed\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No processed RDS files found in the folder!")
# Script 02: Differential Expression and Volcano Plots
# Author: Roozbeh
# Description: Load processed GEO RDS files, perform DE analysis,
#              and generate volcano plots for each dataset.
library(dplyr)
library(tibble)
library(ggplot2)
# ---- Config ----
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_DE_analysis/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# ---- Step 1: List all RDS files ----
rds_files <- list.files(rds_folder, pattern = "_processed\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No processed RDS files found in the folder!")
setwd("C:/Users/asus/Desktop/Roozbeh/NIV-NSW-2025/GitHub/EOC_WNT_TGFb_EMT_Transcriptomics")
# Script 02: Differential Expression and Volcano Plots
# Author: Roozbeh
# Description: Load processed GEO RDS files, perform DE analysis,
#              and generate volcano plots for each dataset.
library(dplyr)
library(tibble)
library(ggplot2)
# ---- Config ----
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_DE_analysis/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# ---- Step 1: List all RDS files ----
rds_files <- list.files(rds_folder, pattern = "_processed\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No processed RDS files found in the folder!")
# Script 03: DE Analysis & Volcano Plots (GitHub-ready)
# Author: Roozbeh
# Description: Automatically load all processed GEO RDS files,
#              perform DE analysis, and generate volcano plots.
library(dplyr)
library(ggplot2)
library(tibble)
# ---- Config ----
rds_folder <- "data/GEO_rds/"                # Folder with processed RDS files
output_folder <- "results/02_DE_analysis/"   # Output folder
dir.create(output_folder, recursive = TRUE, showWarnings = FALSE)
# ---- Find all processed RDS files ----
rds_files <- list.files(rds_folder, pattern = "_processed\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No processed RDS files found!")
# Script 03: Differential Expression and Volcano Plots
# Author: Roozbeh
# Description: Automatically loads all processed GEO microarray RDS files,
#              performs differential expression (DE) analysis for case vs control,
#              and generates Volcano plots. Ready for GitHub/Zendodo.
# ---- Libraries ----
library(dplyr)
library(limma)
library(ggplot2)
library(stringr)
# ---- Config ----
# Full path to RDS folder (modify if moved)
rds_folder <- "C:/Users/asus/Desktop/Roozbeh/NIV-NSW-2025/GitHub/EOC_WNT_TGFb_EMT_Transcriptomics/data/GEO_rds/"
output_folder <- "results/03_DE_volcano/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# ---- Step 1: List RDS files ----
rds_files <- list.files(rds_folder, pattern = "_processed\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No processed RDS files found in the folder!")
# Script 03: Differential Expression and Volcano Plots for All GEO RDS
# Author: Roozbeh
# Description: Loads all processed GEO RDS files from 'data/GEO_rds/', performs differential expression
#              analysis, and generates volcano plots for each dataset.
library(dplyr)
library(ggplot2)
# ---- Config ----
rds_folder <- "data/GEO_rds/"          # Ù…Ø³ÛŒØ± RDS Ù‡Ø§
output_folder <- "results/03_DE_volcano/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# ---- Step 1: Load all RDS files ----
rds_files <- list.files(rds_folder, pattern = "\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No RDS files found in the folder!")
geo_data_list <- lapply(rds_files, readRDS)
names(geo_data_list) <- gsub("\\.RDS$", "", basename(rds_files))
# ---- Step 2: Differential Expression & Volcano Plots ----
for(name in names(geo_data_list)) {
message("Processing dataset: ", name)
geo <- geo_data_list[[name]]
# ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… geo ÛŒÙ‡ data.frame Ø¨Ø§ Ø³ØªÙˆÙ† 'expression' Ùˆ 'group' Ø¨Ø§Ø´Ù‡
# (Ø§Ú¯Ø± Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ ÙØ±Ù‚ Ø¯Ø§Ø±Ù† Ø¨Ø§ÛŒØ¯ Ù…Ø·Ø§Ø¨Ù‚ dataset Ø§ØµÙ„Ø§Ø­ Ø¨Ø´Ù‡)
expr <- geo$expression
pheno <- geo$group
# Ø¯ÛŒÙØ±Ø§Ù†Ø´ÛŒØ§Ù„ Ø§Ú©Ø³Ù¾Ø±Ø´Ù† Ø³Ø§Ø¯Ù‡: t-test Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú˜Ù†
de_res <- apply(expr, 1, function(gene) {
t_res <- t.test(gene ~ pheno)
c(logFC = mean(gene[pheno=="Case"]) - mean(gene[pheno=="Control"]),
pval = t_res$p.value)
})
de_res <- as.data.frame(t(de_res))
de_res$gene <- rownames(de_res)
# ÙˆÙ„Ú©Ø§Ù†Ùˆ Ù¾Ù„Ø§Øª
de_res <- de_res %>%
mutate(sig = ifelse(pval < 0.05 & abs(logFC) > 1, "Significant", "Not Sig"))
p <- ggplot(de_res, aes(x=logFC, y=-log10(pval), color=sig)) +
geom_point(alpha=0.6) +
scale_color_manual(values=c("grey","red")) +
theme_minimal() +
labs(title = paste0("Volcano Plot: ", name),
x = "Log2 Fold Change",
y = "-log10(p-value)")
ggsave(filename = file.path(output_folder, paste0(name, "_volcano.png")), plot=p, width=6, height=5)
# Ø°Ø®ÛŒØ±Ù‡ Ø¯ÛŒÙØ±Ø§Ù†Ø´ÛŒØ§Ù„ Ø§Ú©Ø³Ù¾Ø±Ø´Ù†
write.csv(de_res, file=file.path(output_folder, paste0(name, "_DE_results.csv")), row.names = FALSE)
}
# ---- Step 2: Differential Expression & Volcano Plots (fixed) ----
for(name in names(geo_data_list)) {
message("Processing dataset: ", name)
geo <- geo_data_list[[name]]
# ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ expression Ùˆ Ú¯Ø±ÙˆÙ‡
if(is.list(geo) && all(c("expression","group") %in% names(geo))) {
expr <- as.matrix(geo$expression)
pheno <- geo$group
} else if(is.data.frame(geo) && all(c("expression","group") %in% colnames(geo))) {
expr <- as.matrix(geo$expression)
pheno <- geo$group
} else {
warning("Skipping dataset ", name, ": cannot find 'expression' and 'group' columns")
next
}
if(nrow(expr) == 0 || ncol(expr) == 0) {
warning("Skipping dataset ", name, ": expression matrix has zero dimension")
next
}
# Ø³Ø§Ø¯Ù‡â€ŒØªØ±ÛŒÙ† Ø¯ÛŒÙØ±Ø§Ù†Ø´ÛŒØ§Ù„: t-test Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú˜Ù†
de_res <- apply(expr, 1, function(gene) {
t_res <- t.test(gene ~ pheno)
c(logFC = mean(gene[pheno=="Case"]) - mean(gene[pheno=="Control"]),
pval = t_res$p.value)
})
de_res <- as.data.frame(t(de_res))
de_res$gene <- rownames(de_res)
# ÙˆÙ„Ú©Ø§Ù†Ùˆ Ù¾Ù„Ø§Øª
de_res <- de_res %>%
mutate(sig = ifelse(pval < 0.05 & abs(logFC) > 1, "Significant", "Not Sig"))
p <- ggplot(de_res, aes(x=logFC, y=-log10(pval), color=sig)) +
geom_point(alpha=0.6) +
scale_color_manual(values=c("grey","red")) +
theme_minimal() +
labs(title = paste0("Volcano Plot: ", name),
x = "Log2 Fold Change",
y = "-log10(p-value)")
ggsave(filename = file.path(output_folder, paste0(name, "_volcano.png")), plot=p, width=6, height=5)
write.csv(de_res, file=file.path(output_folder, paste0(name, "_DE_results.csv")), row.names = FALSE)
}
# ---- Script 03 Updated: Differential Expression + Volcano ----
# Author: Roozbeh
# Description: Loads processed GEO RDS files, allows user to assign Case/Control,
#              runs differential expression, and generates Volcano plots.
library(dplyr)
library(tibble)
library(ggplot2)
# --- Config ---
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_DE_volcano/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# --- List all RDS files ---
rds_files <- list.files(rds_folder, pattern = "_processed\\.RDS$", full.names = TRUE)
if(length(rds_files)==0) stop("No processed RDS files found!")
# Script 02: Load Processed RDS Files and Prepare for Analysis
# Author: Roozbeh
# Description: Automatically loads all processed GEO microarray RDS files from data/GEO_rds/
#              and combines them into a list for downstream analyses.
# Required libraries
library(dplyr)
library(tibble)
library(stringr)
# ---- Config ----
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_loaded_data/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# Step 1: List all RDS files (accept any .RDS)
rds_files <- list.files(rds_folder, pattern = "\\.RDS$", full.names = TRUE)
if(length(rds_files) == 0) stop("No RDS files found in the folder!")
# ---- Step 2: Load all RDS files into a named list ----
geo_data <- list()
for(f in rds_files) {
gse_id <- str_extract(basename(f), "GSE\\d+")
message("Loading ", gse_id, " ...")
geo_data[[gse_id]] <- readRDS(f)
}
# ---- Step 3: Quick summary of loaded datasets ----
for(gse_id in names(geo_data)) {
cat("Dataset:", gse_id, "\n")
cat("  Samples:", ncol(geo_data[[gse_id]]$exprs), "\n")
cat("  Features:", nrow(geo_data[[gse_id]]$exprs), "\n\n")
}
# ---- Step 4: Save combined list for downstream scripts ----
saveRDS(geo_data, file = file.path(output_folder, "all_GEO_processed_list.RDS"))
message("All datasets combined and saved to ", output_folder)
# ---- Script 03 Updated: Differential Expression + Volcano ----
# Author: Roozbeh
# Description: Loads processed GEO RDS files, allows user to assign Case/Control,
#              runs differential expression, and generates Volcano plots.
library(dplyr)
library(tibble)
library(ggplot2)
# --- Config ---
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_DE_volcano/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# --- List all RDS files ---
rds_files <- list.files(rds_folder, pattern = "_processed\\.RDS$", full.names = TRUE)
if(length(rds_files)==0) stop("No processed RDS files found!")
library(dplyr)
library(tibble)
library(ggplot2)
library(limma)
rds_folder <- "data/GEO_rds/"
output_folder <- "results/02_DE_volcano/"
dir.create(output_folder, showWarnings = FALSE, recursive = TRUE)
# Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
geo_ids <- c("GSE14407", "GSE38666", "GSE52037", "GSE216150")
for(gid in geo_ids){
# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ RDS Ù‡Ø§
expr_file <- paste0(rds_folder, gid, "_expr_raw.RDS")
pheno_file <- paste0(rds_folder, gid, "_pheno_raw.RDS")
expr <- readRDS(expr_file)
pheno <- readRDS(pheno_file)
# Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù† Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§
# pheno$group <- c("Control", "Control", "Case", ...)
# ØªØ±ØªÛŒØ¨ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ Ù…Ø·Ø§Ø¨Ù‚ pheno Ø¨Ø§Ø´Ø¯
print(pheno)
readline(prompt = paste("Ø¨Ø±Ø§ÛŒ ", gid, " Ø³ØªÙˆÙ† 'group' Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯ Ùˆ Enter Ø¨Ø²Ù†ÛŒØ¯..."))
if(!"group" %in% colnames(pheno)) stop("Ø­ØªÙ…Ø§ Ø³ØªÙˆÙ† 'group' Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯")
# DE Ø¨Ø§ limma
design <- model.matrix(~0 + factor(pheno$group))
colnames(design) <- levels(factor(pheno$group))
fit <- lmFit(expr, design)
contrast <- makeContrasts(contrasts="Case-Control", levels=design)
fit2 <- contrasts.fit(fit, contrast)
fit2 <- eBayes(fit2)
de_res <- topTable(fit2, number=Inf, adjust="fdr")
# Ø°Ø®ÛŒØ±Ù‡ CSV
write.csv(de_res, file=paste0(output_folder, gid, "_DE.csv"))
# ÙˆÙ„Ú©Ø§Ù†Ùˆ Ù¾Ù„Ø§Øª
volcano <- ggplot(de_res, aes(x=logFC, y=-log10(P.Value))) +
geom_point(alpha=0.5) +
theme_minimal() +
ggtitle(paste("Volcano Plot:", gid))
ggsave(paste0(output_folder, gid, "_volcano.png"), plot=volcano)
}
